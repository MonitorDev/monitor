PL('Infp',{Const:function(x,a,b,c){this.x=x;x.text=x.xt('ext/layout');this.iz=0;this.id=PL.Editor.g_id();if(a)this.operStart=x.vm().opcs[a];if(b)this.operHelp=x.vm().opcs[b];if(c)x.ext('cmdshfr',c);x.ext('infpid',this.id);this.inf=true;this._x=x.x('ext')||$.x_doc('<ext><layout/><form/><datastore/><command/></ext>');this.aq=!(x instanceof VM.MX.PluginElement);PL.Editor.all[this.id]=this;x.vm().cmd($.x_doc('<insert type="commands" id="insrt_cmd"><js id="saveEdt">PL.Editor.all["'+this.id+'"].save();</js></insert>'));},Extend:[PL.Editor,Fn.EventNode],Helper:{dragId:null,eB:function(a){if(a=='text')a=4;else if(a=='date'||a=='xbox')a=15;else if(a=='spinner')a=12;else if(a=='select')a=-4;else a=0;return a;},ondrop:function(a){this.dragId=a;},ondragend:function(a,n){var b=PL.Editor.all[this.dragId];this.dragId=null;if(!b){for(var c=VM(event.srcElement),i=0;i<c.length;i++)if(c[i].type=='plugin'&&(b=c[i].edt)&&b.inf)break;}if(b){var r=$.r_r(b.win());if(!b.body().contains(r.length?r.item(0):r.parentElement()))return;if(a=='tab'){var z=Math.random(),c=new Fn.DivSet('rows=21,*',200,200,'tabid='+z+' class=f12 contenteditable=false align=left oncontrolselect=PL.Infp.tabControl(this,event) onresizeend=PL.Infp.tabResize(this) oncontextmenu=PL.Infp.tabMenu(this,event)'),d=c.addset('rows=*'),e=c.addfilm('class=tab-dn onkeydown=return(PL.Infp.keydown(this,event)) contenteditable=true min=2_1'),f=new Fn.Oper(d,a,null,{ww:b.win(),attr:'class=tab-up contenteditable=false ondblclick=PL.Infp.tabMenu(this,event)',tabid:z,clk:'PL.Infp.tabClk(this)'});e.add('min=2_1 tabIndex=0 onresizeend=PL.Infp.tabResize(this) ondragstart=return(PL.Infp.tabDrag(this,event))','display:block;').data('content0');e.add('min=2_1 tabIndex=1 onresizeend=PL.Infp.tabResize(this) ondragstart=return(PL.Infp.tabDrag(this,event))','display:block;').data('content1');f.add('tab0','','',!0);f.add('tab1');f.data();b.insertHTML('<div>'+c.html()+'</div>',r);f.x.film={container:f.x.ww.$(c.id),view:this.hk};}else if(a=='table'){var w=Math.min(Math.floor((b.x.wd()-Br.scroll)/n/2),110),s='<TABLE class="mxtbl xdLayout" style="width:100%" cellSpacing=1 cellPadding=0 minus="-11"><COLGROUP>';for(var i=0;i<n;i++){s+='<COL style="padding: 3px 6px 3px 0;width:'+w+'px;text-align:right" ikmin="6"><COL style="padding:3px 0px 3px 6px;" ikmin="6">';}s+='</COLGROUP><TBODY><TR class=tr>';for(var i=0;i<n;i++){s+='<TD><SPAN>:&nbsp;</SPAN><TD>';}b.insertHTML(s+'</TBODY></TABLE>',r);}else if(a=='star'){b.insertHTML('<SPAN class=mx-star>*</SPAN>',r);}else b.make(a);}},tabClk:function(a){while(a&&a.id.indexOf('oper-')<0)a=a.parentNode;var b=this.cW(a);if(b)b.clk();},cW:function(a){var b=Fn.Oper.get(a);if(b&&b.parentNode.x.ww==$.win(a))return b;b=a;while(b&&b.className!='tab-up')b=b.parentNode;var c=this.hj(b),d=new Fn.Oper(null,'tab',null,{ww:$.win(a),clk:'PL.Infp.tabClk(this)',film:{container:c,view:this.hk}});for(var i=0,e,f;i<b.children.length;i++){e=b.children[i];f=d.add(e.innerText);f.id=e.id;Fn.Oper._a[e.id]=f;}d.sel(js.m(c.children[1].firstChild.getAttribute('tabIndex')));return Fn.Oper.get(b==a?a.firstChild:a);},tabMenu:function(a,b){if(b.type=='dblclick'){this.tabEdit(a);}else{var c=a.className=='tab-up',d;if(!c){d=$.r_o($.win(a));c=d&&d.getAttribute('tabIndex')!=null;}if(c){m=new Fn.Menu(this);m.add('ﾱ￠ﾼﾭTAB','',js.fp(this,'tabEdit',a));m.show(b);b.returnValue=!1;b.cancelBubble=!0;}}},tabEdit:function(a){var b=a.getAttribute('tabIndex'),c,d=[];if(b){c=a.parentNode.children[0].children[0].children[0].children[0];c=this.cW(c).parentNode;b=c[b];}else{b=a;if(a.tabid)b=b.children[0].children[0].children[0].children[0];b=this.cW(b);c=b.parentNode;}for(var i=0;i<c.length;i++){d.push('<d c0="'+c[i].attr('tt')+'" c1="'+i+'"/>');}e=$.x_doc('<view><static><fr type="set" rows="*,36" style="margin:3px;padding:3px" hmin="12" vmin="12"><fr type="fieldset" rows="*" fscls="pn_fst" fstx="'+Loc.option+'" hmin="20" vmin="26"><fr type="set" cols="*,56"><fr type="lb" id="lb" class="lb bd-low" hmin="2" vmin="2" scroll="scroll"><tmpl hd="1" ht="18" high="1"><li tp="tx" fld="c0" w="*"/></tmpl><tbody><d c0="'+Loc.text+'"/>'+d.join('')+'</tbody><edit><i tp="text" n="c0" fu="1"/></edit></fr><fr type="oper" face="classic" dir="v" cellspacing="3" align="right"><b t=" '+Loc.add+' " clk="PL.Infp.opt(this,0)"/><b t=" '+Loc.remove+' " clk="PL.Infp.opt(this,1)"/><b t=" '+Loc.move_up+' " clk="PL.Infp.tabEditUp(this)"/><b t=" '+Loc.move_down+' " clk="PL.Infp.tabEditDn(this)"/></fr></fr></fr><fr type="oper" face="classic" align="right" cellspacing="8"><b t=" '+Loc.confirm+' " clk="PL.Infp.tabEditEnd(this)"/><b t=" '+Loc.cancel+' " clk="DFish.g_dialog(this).close()"/></fr></fr></static></view>');VM().cmd({tagName:'dialog',w:300,h:200,src:e,poper:a,args:c});},tabEditEnd:function(a){var b=VM(a),c=b.xs('.//d'),d=DFish.g_dialog(a).getDialogArguments(),e=d.sel().nodeIndex,f=[];b.find('lb').editEnd();while(d.length)d[0].dispose();for(var i=1,g,h;i<c.length;i++){g=c[i];h=g.getAttribute('c1');if(h)f[h]=i-1;d.add(g.getAttribute('c0'));}d.sel(e);g=d.x.film.container;g.children[0].children[0].children[0].innerHTML=d.html();c=g.children[1].children;for(var i=0;i<c.length;i++){h=js.m(c[i].getAttribute('tabIndex'));c[i].setAttribute('tabIndex',f[h]);}if(h!=f){c[h].swapNode(c[0]);}DFish.g_dialog(a).close();},tabEditUp:function(a){VM(a).find('lb').moveUp();},tabEditDn:function(a){VM(a).find('lb').moveDown();},tabControl:function(a,b){var c=b.srcElement,d=c,e;if(c.className=='right-f')d=c.nextSibling;if(d.id.indexOf('oper-')==0){d=d.parentNode;}if(d.className=='bg'||d.className=='bg-f'){}},hk:function(j){var e=this.container.children[1].children;for(var i=0;i<e.length;i++){if(e[i].getAttribute('tabIndex')==j){e[i].swapNode(e[0]);e[i].style.display='';break;}}},hj:function(a){while(a&&!a.getAttribute('tabid'))a=a.parentNode;return a;},tabResize:function(a){var b=this.hj(a),c=b.children[0],d=a.style.posWidth,e=a.style.posHeight,f=b.children[1],g=f.children;f.style.posWidth=b.style.posWidth=c.style.posWidth=c.firstChild.style.posWidth=c.firstChild.firstChild.style.posWidth=d;f.style.posHeight=e-(b==a?0:21);b.style.posHeight=e+(b==a?21:0);for(var i=0;i<g.length;i++){g[i].style.posWidth=d;g[i].style.posHeight=e-(b==a?0:21);}},tabDrag:function(a,b){if(b.srcElement==a)return false;},attr:function(a,b){var c=a.getAttribute('xd:binding');if(c){return c.slice(c.lastIndexOf(':')+1);}},f_save:function(a){var b=VM(a),c=b.g_form_error();if(c&&c.length)return DFish.alert(c,0,4);var y=DFish.g_dialog(a).getDialogArguments(),x=PL.Editor.all[y[2]],c=PL.Infp.attr(y[1]),d=x.xf(c),e=x.xo('datastore/data_pipe[@input_name="'+c+'"]'),f={'input_name':b.f('n').value,data_type:b.f('data_type').value,store_type:b.f('store_type').value,vector:b.f('vector').value,'case':b.f('case').value},g=b.xs('static//form//i[@n!="hr" and @n!="plugin" and not(contains(@n,"css_"))]'),k=$.x_obj(d);x.f(k.n).setAttribute('xd:binding','my:'+f.input_name);for(var i=0,h,t,m={};i<g.length;i++){h=g[i].getAttribute('n');t=g[i].getAttribute('tp');if(t!='hr'&&b.f(h)){m[h]=b.fv(h);f[h]=b.fv(h);}}var rm=b.ext('mark_rm');if(rm){for(var i in rm){if(!(i in f)){d.removeAttribute(i);e.removeAttribute(i);}}}$.attr(d,m);$.attr(e,f);if(k.tp=='select'||k.tp=='checkbox'||k.tp=='radio'||k.tp=='xbox'){e=x.xd(k.op);f={input_name:f.n,alias:'__'+f.n,store_type:b.fv('op_store_type'),vector:b.fv('op_vector')||'','case':b.fv('op_case')},$.attr(e,f);if(f.store_type=='options'){var n=b.f('op_case'),o;n.view.find('lb').editEnd();o=n.view.xs('.//tbody/d');$.empty(d);for(var i=1,p;i<o.length;i++){p={v:o[i].getAttribute('c0')};if(o[i].getAttribute('c2'))p.checked=1;$.x_add(d,'o',null,o[i].getAttribute('c1'),p);}}}else if(k.tp=='button'){y[1].value=b.f('v').value;}if(k.hdn!=m.hdn){g=x.xs('command//i[@n="'+c+'"]');h=d.cloneNode(true);h.setAttribute('w',b.f('css_w').value);for(var i=0;i<g.length;i++)g[i].parentNode.replaceChild(h,g[i]);$.class_add(y[1],'xdHidden',!js.m(m.hdn));}y[1].style.width=b.f('css_w').value;y[1].style.height=b.f('css_h').value;DFish.g_dialog(a).close();},f_load:function(a){var y=DFish.g_dialog(a).getDialogArguments()[1],w=y.style.width,h=y.style.height;if(w=='18px'&&(y.type=='radio'||y.type=='checkbox')){w='';}a.fs('css_w',w);a.fs('css_h',h);},mark_rm:function(a,b){var c=VM(a);if(!c.ext('mark_rm'))c.ext('mark_rm',{});c.ext('mark_rm')[b]=!0;},tp:function(a){var b;if(a=='PlainText')b='text';else if(a=='dropdown')b='select';else if(a=='ListBox')b='select';else if(a=='OptionButton')b='radio';else if(a=='CheckBox')b='checkbox';else if(a=='File')b='file';else if(a=='DTPicker')b='date';else if(a=='RichText')b='editor';else if(a=='Button')b='button';return b||a;},optlist:function(a){var b=DFish.g_dialog(a).getDialogArguments(),c=PL.Editor.all[b[2]],d=$.xs(c.xf(this.attr(b[1])),'o'),e=[];for(var i=0;i<d.length;i++){e.push('<d c0="'+d[i].getAttribute('v')+'" c1="'+d[i].text+'" c2="'+(d[i].getAttribute('checked')==1?'Y':'')+'"/>');}e=$.x_doc('<view><static><fr type="set" cols="*,56"><fr type="lb" id="lb" class="lb bd-low" hmin="2" vmin="2" scroll="scroll"><tmpl hd="1" ht="18" high="1"><li tp="tx" fld="c0" w="40%"/><li tp="tx" fld="c1" w="40%"/><li tp="tx" fld="c2" w="*"/></tmpl><tbody><d c0="'+Loc.value+'" c1="'+Loc.title+'" c2="'+Loc.default_value+'"/>'+e.join('')+'</tbody><edit><i tp="text" n="c0" fu="1"/><i tp="text" n="c1" fu="1"/><i tp="checkbox" n="c2" fu="1"><o v="Y"/></i></edit></fr><fr type="oper" face="classic" dir="v" cellspacing="3" align="right"><b t=" '+Loc.add+' " clk="PL.Infp.opt(this,0)"/><b t=" '+Loc.remove+' " clk="PL.Infp.opt(this,1)"/></fr></fr></static></view>');a.view=DFish.loadView(e,$.empty(a.$()),a.wd(),100);a.addEventOnce('remove',a.view.dispose,a.view);},opt:function(a,b){var c=VM(a).find('lb');if(b==0){c.insertRow({c0:'',c1:'',c2:''},null,true);}if(b==1){c.deleteRow();}},keydown:function(a,b){var c=$.win(a),d=$.r_o(c),e=b.keyCode;if(d&&d.parentNode==a){if(e==46){return false;}else if(b.ctrlKey&&(e==88||e==67||e==86)){return false;}}},cmd_save:function(a){var y=DFish.g_dialog(a).getDialogArguments(),x=PL.Editor.all[y[2]];if(!x.xo('command'))$.x_add(x.xo(),'command');var b=VM(a),c=b.g_form_error(),d=Fn.Tree.get(y[3]),e=b.f('id').value,k=d.attr('pk'),f=x.xc(e),g=k=='root'?x.xo('command'):x.xc(k),h=b.f('tagName').value;if(!c.length){if((y[1]&&k!=e&&f)||(!y[1]&&f))c=[{msg:'ID:"'+e+'" '+Loc.has_exists,n:'id'}];}if(c&&c.length)return DFish.alert(c,0,4);var o=y[1]?g:$.x_doc('<'+h+'/>'),n={id:e};if(h=='cmd'){}else if(h=='confirm'){n.cn=b.f('cn').value;}else if(h=='js'){o.text=b.f('text').value;}else if(h=='ajax'){n.src=b.f('src').value;}else if(h=='submit'){n.src=b.f('src').value;n.frs=b.f('frs').value;n.loading=b.fv('loading');}else if(h=='dialog'){n.src=b.f('src').value;n.tpl=b.f('tpl').value;n.w=b.f('w').value;n.h=b.f('h').value;n.t=b.f('t').value;}else if(h=='insert'||h=='update'||h=='delete'){n.target=b.f('target').value;n.type='form';if(h=='insert')n.where=b.f('where').value;if(h=='insert'||h=='update'){var p=b.f('hdn').value,q;if(p&&(q=x.xf(p))){if(o.firstChild)o.removeChild(o.firstChild);o.appendChild(q.cloneNode(!0));}}}$.attr(o,n);n={pk:e,t:e+' ('+h+')',hG:h};if(!y[1]){if(d.attr('hG')=='confirm')g=$.x_add(g,'yes');g.appendChild(o);o=$.x_doc('<o/>');$.attr(o,n);Fn.Tree.xadd(d,o);d.toggle(true);}else{o=$.x_doc('<o/>');$.attr(o,n);Fn.Tree.xmodify(d,o);}DFish.g_dialog(a).close();},cmd_del:function(a,b){var c=Fn.Tree.get(b);$.xrm(PL.Editor.all[a].xc(c.attr('pk')));c.remove();},cmd_menu:function(a){var b=new Fn.Menu(),t=a.attr('hG'),p=VM(a,true),v=p.parentNode;for(var i=0;i<v.length;i++){if(v[i].type=='plugin'&&v[i].ext('cmdshfr')==p.frid)break;}p=PL.Editor.all[v[i].ext('infpid')];if(a.nodeIndex>-1){var x=p.xc(a.attr('pk'));b.add(Loc.edit,null,js.fp(VM(p.x.vm().id),'cmd','cmdedit',t,x.xml,p.id,a.id));b.add(Loc.remove,null,'PL.Infp.cmd_del("'+p.id+'","'+a.id+'")');}if(t=='cmd'||t=='confirm'){if(b.length)b.addsplit();var c=['Group','Confirm','Dialog','JS','Ajax','Submit','Insert','Update','Delete'];for(var i=0,d;i<c.length;i++){d=i?c[i].toLowerCase():'cmd';b.add(Loc.add+' '+c[i],null,'VM("'+p.x.vm().id+'").cmd("cmdedit","'+d+'","","'+p.id+'","'+a.id+'")');}}b.show();},cmd_edit:function(a){if(a.nodeIndex==-1)return;var t=a.attr('hG'),p=VM(a,true),v=p.parentNode;for(var i=0;i<v.length;i++){if(v[i].type=='plugin'&&v[i].ext('cmdshfr')==p.frid)break;}p=PL.Editor.all[v[i].ext('infpid')];VM(p.x.vm().id).cmd('cmdedit',t,p.xc(a.attr('pk')).xml,p.id,a.id);},cmd_load:function(a){var b=a.f('tagName').value;if(b=='insert'||b=='update'){var y=DFish.g_dialog(a).getDialogArguments(),p=PL.Editor.all[y[2]],b=p.xs('form/i[@hdn="1"]'),c=a.f('hdn'),d=y[1]&&$.xt($.x_doc(y[1]),'i/@n');for(var i=0,e;i<b.length;i++){e=b[i].getAttribute('n');if(p.f(e)){c.add(new Option(e,e));if(e==d)c.selectedIndex=i;}}}},cu:function(table,terminatingCell){var cellNum,colNum,aTiles=[];for(var rowNum=0;rowNum<table.rows.length;++rowNum){var thisRow=table.rows[rowNum];for(cellNum=0,colNum=-1;cellNum<thisRow.cells.length;++cellNum){var thisCell=thisRow.cells[cellNum];while(aTiles[rowNum+"x"+(++colNum)]);for(var i=0;i<(thisCell.rowSpan||1);++i)for(var j=0;j<(thisCell.colSpan||1);++j)aTiles[(rowNum+i)+"x"+(colNum+j)]=thisCell;thisCell.tile=[rowNum,colNum];if(thisCell==terminatingCell)return thisCell.tile;}}return aTiles;},cellIndex:function(a){if(a.tile)return a.tile[1];return this.cu(Q(a).closest('table')[0],a)[1];},cellWidth:function(a){var b=this.cellIndex(a),c=Q(a).closest('table').find('col:eq('+b+')');return c.css('posWidth')||a.clientWidth;}},Prototype:{fd:false,iQ:VM.MX.prototype.iQ,hQ:0,uni:function(){var a=this.hQ+1;while(this.xf('field'+a)||this.xd(a))a++;return this.hQ=a;},f:function(a){var b='[xd:binding$=my:'+a+']',c=$.query('SPAN'+b+',INPUT'+b+',SELECT'+b,this.dc());if(c.length)return c.length>1?c:c[0];},xo:function(a){return a?$.x(this._x,a):this._x;},xs:function(a){return $.xs(this._x,a);},xc:function(a){return $.x(this._x,'command//*[@id="'+a+'"]');},xf:function(a){return $.x(this._x,'form//i[@n="'+a+'"]');},xd:function(a){return $.x(this._x,'datastore/data_pipe[@pipe_id="'+a+'"]');},format:function(type,para){if(!this.validateMode())return;this.focus();if((type=='cut'||type=='copy')&&this.drawObj&&this.drawObj.iconpro.dW(type))return;if((type=='paste')&&this.drawObj&&this.drawObj.iconpro.dX())return;var c=$.r_s(this.win()),d=this.dc();if(c.type=='None'){d=c.createRange();if(this.ace&&this.ace!=this.body())d.moveToElementText(this.ace.parentNode);}if(!para)if(Br.ie)return d.execCommand(type);else return d.execCommand(type,false,false);else return d.execCommand(type,false,para);},init:function(){var v=this.x.text?this.x.text:this.x.xt('ext/v');if(!this.$())this.render();this.render_editor(v);this.isEditMode=true;this.vis=true;},render_editor:function(v){if(this.cG){$.e_remove(this.dc(),'contextmenu',this.cG);}var a=this.id,b=$.htm.jstag()+'<script>var PL=parent.PL;</script><link rel="stylesheet" href="'+Cfg.path+'css/global.css" type="text/css"/><link rel="stylesheet" href="'+Cfg.path+'css/'+Cfg.skin+'/style.css" type="text/css"/><link rel="stylesheet" href="'+Cfg.path+'js/pl/infp/infp.css" type="text/css"/>';$.wr(this.win(),$.htm.vmltag('table{border-collapse:collapse}',b)+'<body topmargin=0 onresizestart=PL.Editor.all["'+a+'"].rszing=1 onresizeend=PL.Editor.all["'+a+'"].rszing=0 contentEditable="'+this.canedit()+'" onmousemove=PL.Editor.all["'+a+'"].msmove(event) onmousedown=PL.Editor.all["'+a+'"].msdown(event) ondblclick=PL.Editor.all["'+a+'"].dblclk(event) onclick=PL.Editor.all["'+a+'"].clk(event) ondrop=PL.Infp.ondrop("'+a+'")>'+(v||'')+'</body></html>');if(!this.vis&&this.body())this.x.text=this.body().innerHTML;this.cG=js.fp(this,'oncontextmenu');$.e_add('contextmenu',this.cG);this.isEditMode=!0;this.vis=!0;var b=$.tags('TABLE',this.body());for(var i=0,c;i<b.length;i++){if((c=b[i]).className=='mxtbl xdLayout'){c.style.width='100%';}}},render:function(){if(this.operStart){this.operStart.add({clk:'PL.Editor.all["'+this.id+'"].action(this,-1)',ic:'img/b/save.gif',t:Loc.save});this.operStart.addsplit();this.tabStart();this.operStart.data();}if(this.operHelp){this.tabHelp();this.operHelp.data();}this.x.$().innerHTML='<textarea name='+this.x.name+' id='+this.id+'-txr style="display:none;width:'+(this.x.wd()-8)+'px;height:'+(this.x.ht()-6)+'px;"></textarea>'+$.htm.iframe(this.x.wd(),this.x.ht(),null,this.id)+'</td></tr></table>';if(this.x.ext('cmdshfr'))this.gb(this.xo('command'),this.x.vm().find(this.x.ext('cmdshfr')).get('root'));},gb:function(a,b){var c=$.xs(a,(a.tagName=='confirm'?'yes/':'')+'*');for(var i=0;i<c.length;i++){var d=c[i],e=d.getAttribute('id'),f=d.tagName;e=Fn.Tree.xadd(b,$.attr($.x_doc('<d/>'),{t:e+' ('+f+')',pk:e,hG:f}));if(f=='cmd'||f=='confirm')arguments.callee(d,e);}},view:function(){var x=this.x,a=x.xt('ext/layout'),b=x.xs('ext/form/i');if(!this.parentNode)this.parentNode=x.vm();for(var i=0;i<b.length;i++){var o=b[i],c=$.x_obj(o),d,e=RegExp('<(SPAN|SELECT|INPUT)([^>]*?my:'+c.n+'"[^>]*?)>(.*?<\\/\\1>)?','i'),f,h;js.m_obi(c,'rdn','rdn1','ds','ntn','fu');c.vmid=this.parentNode.id;c.mxid=x.mxid;c.noshct=1;if(f=a.match(e)){if(c.hdn==1){a=a.replace(e,'');}else{h=PL.Infp.eB(c.tp);f=f[2].replace(/FONT-SIZE: x-small;/g,'padding:0').replace(/xdTextBox/g,'mx_text');f=f.replace(/class="?xdXbox"?/g,'class="mx_text xbox"').replace(/class="?xdCombox"?/g,'class="txsel"').replace(/class="?(?:xdDTPicker|xdSpinner)"?/g,'class="mx_text left"').replace(/height: (\w+);?/gi,function($0,$1){c.h=js.m($1);return c.tp=='textarea'?$0:'';}).replace(/width: ([\w%]+);?/gi,function($0,$1){c.w=js.m($1.indexOf('%')!=-1?c.w:$1)-h;return 'width:'+c.w+'px;';});if(c.graytip&&!c.v)f=f.replace(/(style=")(.*?")/,'$1color:#b1b1b1;$2');if(h)f+=' minrt='+h;if(c.tp=='editor'){o.setAttribute('tp',c.tp='plugin');if(Cfg.infp_editor_xml){var n=$.x_doc(js.s_printa(Cfg.infp_editor_xml,[c.h||200]));for(var k in c)n.setAttribute(k,c[k]);var nv=$.x(n,'value');if(!nv)nv=$.x_add(n,'value');$.xcdata(nv,c.v);o=$.replaceWith(o,n);}else{var tmp=$.x_add(o,'js','','','sync','0');$.x_add(tmp,'src','','js/pl/ueditor/editor_config.js');$.x_add(tmp,'src','','js/pl/ueditor/editor_all.js');$.x_add(tmp,'src','','js/pl/ueditor/editor_dfish.js');tmp=$.x_add(o,'css');$.x_add(o,'beforeload','','return "loading..."');$.x_add(o,'load','','new PL.UEditor(this, {initialFrameHeight:'+(c.h||300)+'});');$.x_add(o,'value','',o.getAttribute('v'));}}d=VM.MX.f_html(this,c,o,f);if(d)a=a.replace(e,d.replace(/\btitle=[^ ]+/g,'').replace(/\btitle="[^"]+"/g,''));}}}a=a.replace(/(<TABLE[^>]*?xdLayout[^>]*?)border=1([^>]*?>)/g,'$1$2').replace(/(<\/?)P\b/g,'$1div').replace(/ contentEditable="?\w+"?/g,'').replace(/<DIV ([^>]*)min="(\w+)"([^>]*)>/g,function($0,$1,$2,$3){var a=$1+$3,b=$2.split('_');a=a.replace(/\bwidth: (\w+);?/gi,function($a,$b){return 'width:'+(js.m($b)-js.m(b[0]))+'px;';}).replace(/\bheight: (\w+);?/gi,function($a,$b){return 'height:'+(js.m($b)-js.m(b[1]))+'px;';});return '<DIV '+a+'>';}).replace(/ id=(oper-\d+)/g,function($0,$1){return ' id='+Fn.Oper.g_id()}).replace(/ id=(fndiv-\d+)/g,function($0,$1){return ' id='+Fn.Div.g_id()});x.html('<div style=width:'+x.wd()+'px;>'+a+'</div>');var c=$.tags('TABLE',x.$()),d=x.mx().eI,e=x.mx().fj;for(var i=0,f;i<c.length;i++){if((f=c[i]).className=='mxtbl xdLayout'){var g=js.find(f.children,'v.tagName=="COLGROUP"'),w=x.wd(),h=[];f.cellPadding=f.cellSpacing=0;for(var j=0;j<g.children.length;j++){h.push(j%2?'*':d[0]+1);}h=js.m_scale(w,h.join());for(j=0;j<g.children.length;j++){g.children[j].style.width=(h[j]-6)+'px';}for(var j=0,l=f.rows.length;j<l;j++){var p=f.rows[j];if(p.style.height){p.style.minHeight=(p.style.posHeight-6)+'px';p.style.height='';}if(Br.cmp){for(var k=0;k<p.cells.length;k++)p.cells[k].style.cssText=g.children[k].style.cssText;}else{p.style.overflow='auto';}if(j==0){js.each(p.cells,'v.style.paddingTop=0');}if(j==l-1){js.each(p.cells,'v.style.paddingBottom=0');}}}}for(var i=0;i<b.length;i++){var c=$.x_obi(b[i]),d=x.vm().f(c.n);if(d){var w=x.mx().g_i_wd(c.face||c.tp),W=c.W||c.w;if(d.$)d=d.$();if(w){if(W){var t=js.m(W),r=W.indexOf('%')>0;if(r&&t>97)t=100;w=r?Math.floor(w*t/100):js.m(W);}else{var wd=d.style.width;if(wd&&c.tp=='spinner'){w=js.m(wd);}}}else{var p=d,q;while(p&&p.tagName!='TD')p=p.parentNode;if(!p)continue;w=PL.Infp.cellWidth(p);if(w<1)w=js.m(p.currentStyle.width);if(!w||isNaN(w))w=120;if(W){var t=js.m(W),r=W.indexOf('%')>0;if(r&&t>97)t=100;w=r?Math.floor(w*t/100):js.m(W);}if(q=d.minrt)w-=js.m(q);if(q=d.minus)w-=js.m(q);w-=8;}if(c.tp!='date')d.style.width=w+'px';if(c.tp=='textarea'&&!d.style.height)d.style.height=((c.rows||5)*16)+'px';if(c.tp=='plugin')x.vm().f(c.n,DFish.RESIZE,[w]);if(c.ntn==1){Q(d).closest('td').prev().each(function(v){var s=this.innerHTML,v='<span class=mx-star>*</span>';if(s.indexOf('*')<0){this.innerHTML=s.indexOf(':')>0?s.replace(/:/,':'+v):s+v;}});}}}a=this.xo('command');if(a)VM.x_mrg(x.vm().xml,a);x.mx().atchev(this.xs('form//i[@on="1"]'));this.fireEvent('render');},save:function(s){PL.Editor.prototype.save.call(this);var a=this.x.vm(),b=['ename','cname','version','table_primary','oper_code','desc_info','remark'],c=['<formprops>'];for(var i=0;i<b.length;i++){c.push('<dyn_'+b[i]+'><![CDATA['+a.fv('dyn_'+b[i])+']]></dyn_'+b[i]+'>');}$.xrm(this.xo('formprops'));this.xo().appendChild($.x_doc(c.join('')+'</formprops>'));b=this.xs('form/i');for(var i=b.length-1;i>=0;i--){c=b[i];if(!this.f(c.getAttribute('n'))){$.xrm(this.xd(c.getAttribute('vp')));$.xrm(this.xd(c.getAttribute('op')));$.xrm(c);}}b=this.xs('form/i');c=$.query('SPAN[xd:binding],INPUT[xd:binding],SELECT[xd:binding]',this.dc());for(var i=0,d,e;i<c.length;i++){this.make(c[i]);if(d=this.xf(PL.Infp.attr(c[i]))){e=c[i].style.width;if(e.indexOf('%')>0)d.setAttribute('W',e);d.setAttribute('w',c[i].offsetWidth+'px');}}$.xcdata(this.xo('layout'),this.val());a.f('dyn_metadate').value=this.xo().xml;if(s)this.x.vm().cmd(s);},make:function(a){var b=typeof a=='object',c=b?a.getAttribute('xd:xctname'):a,d,e;if(b){if(this.xf(PL.Infp.attr(a)))return;d=this.uni();e=PL.Infp.attr(a);}else{d=this.uni();e='field'+d;}var f=' contentEditable=false xd:xctname='+c+' xd:binding="my:'+e+'" title="'+e+'" style=width:',g={tp:PL.Infp.tp(c),n:e,t:'',v:'',vp:d},h={pipe_id:d,input_name:e,data_type:'string',data_attrib:'w/r'},k,s='',tc=this.isCursorInTableCell(),w=tc?'98%':'120px';if(b)g.t=a.title;if(c=='PlainText'){if(b)g.graytip=a.innerHTML;else s='<SPAN class=xdTextBox'+f+w+';></SPAN>';}else if(c=='textarea'){if(b)g.graytip=a.innerHTML;else s='<SPAN class=xdTextArea'+f+w+';height:55px;></SPAN>';}else if(c=='password'){s='<SPAN class=xdPassword'+f+w+';></SPANs>';}else if(c=='hidden'){s='<SPAN class=xdHidden'+f+'18px;></SPAN>';}else if(c=='dropdown'){s='<SELECT class="xdComboBox xdBehavior_Select"'+f+w+';></select>';var m=this.uni();k=js.clonei({pipe_id:m},h);g.op=m;g.oi='';}else if(c=='ListBox'){s='<SELECT class="xdListBox xdBehavior_Select" multiple size=3'+f+w+';></SELECT>';var m=this.uni();k=js.clonei({pipe_id:m},h);g.op=m;g.oi='';}else if(c=='OptionButton'){s='<INPUT class=xdBehavior_Boolean type=radio name='+d+f+'18px>';var m=this.uni();k=js.clonei({pipe_id:m},h);g.op=m;g.oi='';}else if(c=='CheckBox'){s='<INPUT class=xdBehavior_Boolean type=checkbox'+f+'18px>';var m=this.uni();k=js.clonei({pipe_id:m},h);g.op=m;g.oi='';}else if(c=='File'){s='<SPAN class=xdFile'+f+'81px>'+Loc.form.add_file+'</SPAN>';g.downurl='';g.one=0;}else if(c=='DTPicker'){s='<SPAN class=xdDTPicker'+f+w+'></SPAN>';g.df='yyyy-mm-dd hh:ii';}else if(c=='spinner'){s='<SPAN class=xdSpinner'+f+'120px></SPAN>';g.showbtn=1;}else if(c=='xbox'){s='<SPAN class=xdXbox'+f+w+'></SPAN>';var m=this.uni();k=js.clonei({pipe_id:m},h);g.op=m;g.oi='';}else if(c=='combobox'){s='<SPAN class=xdCombox'+f+w+'></SPAN>';}else if(c=='pickbox'){s='<SPAN class=xdPickbox'+f+w+'></SPAN>';}else if(c=='RichText'){s='<SPAN class="xdRichTextBox xdBehavior_GhostedText"'+f+w+'></SPAN>';}else if(c=='Button'){s='<INPUT type=button class=xdButton'+f+'30px;height:20px>';}if(!b)this.insertHTML(s,$.r_r(this.win()));$.x_add(this.xo('datastore'),'data_pipe',null,null,h);if(k)$.x_add(this.xo('datastore'),'data_pipe',null,null,k);k=$.x_add(this.xo('form'),'i',null,null,g);if(b&&g.tp=='select'){for(var i=0;i<a.length;i++){var m={v:a[i].value};if(a.selectedIndex==i)m.checked=1;$.x_add(k,'o',null,a[i].text,m);}}},addcheck:function(){if(this.aq){this.x.addcheck.apply(this.x,arguments);}else{this.x.mx().addcheck.apply(this.x.mx(),arguments);}},addpl:function(a,b){if(this.aq){this.x.addpl.apply(this.x,arguments);}else{this.x.mx().addpl.apply(this.x.mx(),arguments);}},dblclk:function(a){var b=$.r_o(this.win(),!0);if(!b)return;var c=b.getAttribute('xd:xctname'),d=PL.Infp.attr(b);if(c){$.r_s(this.win()).empty();this.make(b);var e=this.xf(d),f=this.xs('datastore/data_pipe[@input_name="'+d+'"]'),g=['<edit code="'+this.x.vm().fv('dyn_oper_code')+'">'+e.xml];for(var i=0;i<f.length;i++)g.push(f[i].xml);if(f=this.xo('extend'))g.push(f.xml);this.x.vm().cmd('popedit',g.join('')+'</edit>',b,this.id);}},clk:function(a){this.ace=this.dc().activeElement;},dispose:function(){this.fireEvent('beforeupdate');PL.Editor.prototype.dispose.call(this);}}}); 