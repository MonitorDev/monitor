Fn.fW('VM.IMG',{Const:function(a){VM.Base.call(this,a);},Helper:{load:function(o){$.imgfix(o,o.getAttribute('maxw'),o.getAttribute('maxh'));},clk:function(a){var v=VM(a,true),t=v.dH;if(t)v.focus(a,t==2?null:true);if(v.hw)v.fire(a,v.hw);if(!v._disposed&&$.class_any(event.srcElement,'vi-ic'))v.fire(a);},menu:function(a){var v=VM(a,true);if(v._tch_menu)v.fire(a,v._tch_menu);},over:function(a){$.class_add(a,'hv');},out:function(a){if(!a.contains(event.toElement)){$.class_del(a,'hv');}}},Extend:[VM.Base],Prototype:{type:'img',iw:null,ih:null,design:function(a,b,_0,_1,_2,_3){this.jd=this.xt('pub/filter');this.ej=this.xi('tmpl/@limit');this.dH=this.xi('pub/high/@type');this.dG=this.xi('pub/high/@mul');this.hw=this.xt('pub/attach/@clk');this._tch_menu=this.xt('pub/attach/@menu');this.aI=this.xt('tmpl/box/@fld');this.aJ=this.xt('tmpl/box/@n')||'selectItem';this.aH=this.xt('tmpl/box/@chfld');this.bf=this.xt('tmpl/box/@dsfld');this.aL=this.xi('tmpl/box/@ntn');this.cm=this.xt('pub/face/@v')||'normal';this.dF=0;this.div=a.add(_0,_1,_2,_3,b.getAttribute('scroll'));this.div.addEvent('resize',js.fp(this,'resize'));return this.div;},data:function(pg){var a=this.div,b=$.x_obj(this.x('tmpl/title')),c=$.x_obj(this.x('tmpl/img')),d=VM.LB.cM(this.x(),this.jd,pg),e=[],l=d.length;if(!c)return;this.bB=l;this.fk=pg==null?(this.ej?1:pg):pg;c.w=js.m(c.w);c.h=js.m(c.h);this.hspace=js.m(c.hspace)||20;this.vspace=js.m(c.vspace)||20;c.maxw=c.maxw=='0'?0:Math.max(c.w,js.m(c.maxw))||100;c.maxh=c.maxh=='0'?0:Math.max(c.h,js.m(c.maxh))||100;this.ih=(c.maxh||c.h);this.iw=(c.maxw||c.w);if(b&&b.ps)b.fJ=this.g_ps(b.ps);if(c.ps)c.fJ=this.g_ps(c.ps);this.dO=c;this.hN=b;if(l){e.push('<ul id='+this.id+'-ul class="vm-img'+(this.cm==='normal'?'':'-'+this.cm)+'">');for(var i=0;i<l;i++){e.push(this.data2html(d[i],i));}e.push('</ul>');}a.data(e.join(''));},data2html:function(x,i){var a=this.dO,b=this.hN,c=this.aH&&x.getAttribute(this.aH)==='1',d=a.fld&&x.getAttribute(a.fld),n=this.cm==='normal',z='width:'+(this.iw+2)+'px;height:'+(this.ih+5)+'px;';e='<li class="vi-l'+(c?' on':'')+'" style="margin-top:'+this.vspace+'px;margin-left:'+this.hspace+'px" class=vi data-index='+i+' onclick=VM.IMG.clk(this) oncontextmenu=VM.IMG.menu(this) onmouseover=VM.IMG.over(this) onmouseout=VM.IMG.out(this)>'+(n?'<table cellspacing=0 cellpadding=0':'<div')+' class=vi-b>'+(n?'<tr><td class=vi-tl><td class=vi-tc><td class=vi-tr><tr><td class=vi-ml><td class=vi-mc><div class=relative>':'')+(this.aI?'<div class="vi-bx'+(c?' z-ck':'')+'"><input type=checkbox class=vi-bx-el name='+this.aJ+' value="'+(x.getAttribute(this.aI)||'')+'"'+(c?' checked':'')+(this.bf&&x.getAttribute(this.bf)==1?' disabled':'')+'></div>':'')+'<div class="vi-bg" style="'+z+'">';if(d){e+='<a class="vi-a i-c" style="display:inline-block;'+z+'" href=javascript:void(0) hidefocus><i></i>';if(a.ps)e+=VM.iH(a.fJ,x);else{e+='<img class=vi-ic src='+d+(a.w?' width='+a.w:'')+(a.h?' height='+a.h:'')+'  style="max-width:'+a.maxw+'px;max-height:'+a.maxh+'px;'+(a.style||'')+'"';if(a.on){for(var i in a){if(i.indexOf('on_')===0){e+=' '+i.replace('_','')+'=VM._a["'+this.id+'"].fire(this)';}}}if(a.alt){var alt=x.getAttribute(a.alt);if(alt)e+=' title="'+js.s_quot(alt)+'"';}e+='>';}e+='</a>';}e+='</div>';if(b){var t=b.ps?VM.iH(b.fJ,x):x.getAttribute(b.fld);e+='<div class="vi-tt '+(b.nobr?'fix':'wdbr')+'" style="width:'+(b.w||a.maxw)+'px">'+t+'</div>';}return e+(n?'</div><td class=vi-mr><tr><td class=vi-bl><td class=vi-bc><td class=vi-br></table>':'</div>')+'</li>'},fL:function(){if(!this.vis){var a=this.xt('pub/high/@n');if(a){this.focus(js.m(a));}this.fireEvent('render');}},g_imgs:function(){return $.query('IMG.vm-img-img',this.$());},g_ps:function(a){return this.parentNode.xt('parsers/*[@id="'+a+'"]');},high:function(a,b){var c=this.g_imgs(),d=$.xp(a);for(var i=0;i<c.length;i++)c[i].parentNode.parentNode.style.background=i==d?b:'';},focus:function(a,b){if(typeof a==='boolean'){var b=$.query('.vi-l'+(a===false?'.on':''),this.$());for(var i=0;i<b.length;i++)this.focus(b[i],a);return;}var c='on',d=this.dn(a),e=$.query('.vi-l',this.$()),g=[];for(var i=0,f,h;i<d.length;i++){h=$.xp(d[i]);g.push(h);if(f=e[h]){var m=b===false||(b==null&&$.class_any(f,c));$.class_add(f,c,m);if(this.aI){var o=$.query('.vi-bx',f)[0];$.class_add(o,'z-ck',m);if(!o.children[0].disabled)o.children[0].checked=!m;}}}if(!this.dG){for(var i=0;i<e.length;i++){if(js.index(g,i)<0&&!(b===false||(b==null&&!$.class_any(e[i],c)))){$.class_del(e[i],c);if(this.aI){var o=$.query('.vi-bx',e[i])[0];$.class_del(o,'z-ck');if(!o.children[0].disabled)o.children[0].checked=false;}}}}},isFocus:function(a){var c=this.dj(a);return $.query('.vi-l.on[data-index="'+c+'"]',this.$()).length>0},getRowData:function(a){var r=js.type(a)=='html'?this.el2x(a):VM.LB.prototype.dk.call(this,a);return r?$.x_obj(r):null;},checkAll:function(y){this.focus(y)},getBox:VM.LB.prototype.getBox,getSelectedData:VM.LB.prototype.getSelectedData,el2x:function(a,b){if(b)return this.el2x(a).getAttribute(b);var c=$.pcls(a,'vi-l'),d=js.m(c.getAttribute('data-index'));return this.jd?this.xs('tbody/d['+this.jd+']')[d]:this.x('tbody/d['+(d+1)+']');},x2img:function(a){if(typeof a==='string')a=this.x('tbody/d['+a+']');return this.g_imgs()[$.xp(a)];},fire:function(a,b){b=b||this.xt('tmpl/img/@on_'+event.type);Function(js.s_printx(b,this.el2x(a))).call(a);},filter:function(a){this.jd=a;this.data();},g_form_error:VM.LB.prototype.g_form_error,page:VM.LB.prototype.page,dj:VM.LB.prototype.dj,dk:VM.LB.prototype.dk,dn:function(a){return js.type(a)==='html'?[this.el2x(a)]:VM.LB.prototype.dk.call(this,a,true);},resize:function(){},show:function(){$.toggle(this.div.parentNode.$(),true)},hide:function(){$.toggle(this.div.parentNode.$(),false)},trows:function(a){return a==null?$.query('.vi-l',this.$()):this.trows()[a]},insertRow:function(a,z){var b=this.trows().length;if(z!=null&&z<0)z=b+z;var c=z==null?b:this.dj(z),f=[];if(!js.isArray(a))a=js.array(a);for(var i=a.length-1;i>-1;i--){if(js.type(a[i])==='xml'){$.append(this.x('tbody'),a[i],c+this.dF);f.push.apply(f,js.map($.xs(a[i],'c/i')));}else a[i]=$.x_add(this.x('tbody'),'d',c+this.dF,null,a[i]);}if(this.$()){var e=document.createElement('ul'),f,r=this.trows(c);for(var i=0,s=[];i<a.length;i++){s.push(this.data2html(a[i],c));}e.innerHTML=s.join('');f=document.createDocumentFragment();while(e.firstChild)f.appendChild(e.firstChild);r?r.parentNode.insertBefore(f,r):$(this.id+'-ul').appendChild(f);e=null;this.reIndex(c);}},reIndex:function(a){var b=$.query('.vi-l',this.$());for(var i=a;i<b.length;i++){b[i].setAttribute('data-index',i);}},updateRow:function(a,b){var c=this.dk(b);if(!c)return;var d=$.xp(c),e=c.cloneNode(true),f=this.isFocus(b);a=a?(a.nodeType!=1?js.extend(a,$.x_obj(e)):a):e;this.bD(d);this.insertRow(a,d);if(f){this.focus(b);}},bD:function(a,z){var b=this.dk(a),c;if(b){c=$.xp(b);$.rm(this.trows(c));$.xrm(b);if(typeof a==='object'&&!a.nodeType&&this.dk(a))c=Math.min(c,this.bD(a))}return c},deleteRow:function(a){this.bD(a);this.reIndex(c);}}}); 